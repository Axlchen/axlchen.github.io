<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Blog of Axlchen,about technology</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Blog of Axlchen,about technology">
<meta property="og:url" content="https://axlchen.github.com.io/index.html">
<meta property="og:site_name" content="Blog of Axlchen,about technology">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Blog of Axlchen,about technology">
  
    <link rel="alternate" href="/atom.xml" title="Blog of Axlchen,about technology" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Blog of Axlchen,about technology</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">回到最初的好玩与有趣</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://axlchen.github.com.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-个人开发工具栈记录" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/08/22/个人开发工具栈记录/" class="article-date">
  <time datetime="2017-08-22T11:55:01.000Z" itemprop="datePublished">2017-08-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/其他/">其他</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/22/个人开发工具栈记录/">个人开发工具栈记录</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>俗话说，工欲善其事，必先利其器，在开发过程中，我们用到各种各样的工具，它们不但可以加快开发的效率，还能一定程度上降低出错率。虽然这样会让我们对工具的依赖程度加深，但是高效、省事的工具谁不用呢？</p>
<p>今天突发奇想，想记录一下平时用来开发的工具。平时我们经常听到XX栈这样的名词，我想，给这些工具集合起个名字的话，就叫工具栈吧。</p>
<p>当学会使用新的有趣、有生产力、高效额工具后，会不定期更新这个文章，作为个人工具栈发展得记录。</p>
<blockquote>
<p>有使用相同工具的小伙伴可以讨论一下哦，或者有更高效额工具请推荐一下~</p>
</blockquote>
<hr>
<blockquote>
<p>OS</p>
</blockquote>
<ul>
<li>Windows 7（工作用，公司只能用win没办法）</li>
<li>OSX 10.12（个人的macbook air）</li>
<li><a href="https://www.linuxmint.com/" target="_blank" rel="external">Linux mint</a> 17.3（认为是最适合我的linux发行版）</li>
</ul>
<hr>
<blockquote>
<p>IDE</p>
</blockquote>
<ul>
<li><p>Android Studio</p>
<blockquote>
<p>插件 （使用得比较多的）</p>
</blockquote>
<ul>
<li>GenyMotion插件</li>
<li><a href="https://github.com/takahirom/android-postfix-plugin" target="_blank" rel="external">Android Postfix Completion</a></li>
<li>Markdown suport<p></p></li>
</ul>
</li>
<li><p>Intellij IDEA（偶尔写写纯java用，还有可以用来写jetbrains系列ide的插件）</p>
</li>
<li><p>Eclipse（已放弃）</p>
</li>
</ul>
<hr>
<blockquote>
<p>代码比较</p>
</blockquote>
<ul>
<li><a href="http://www.scootersoftware.com/download.php" target="_blank" rel="external">Beyond Compare</a>（跨平台）</li>
</ul>
<hr>
<blockquote>
<p>浏览器</p>
</blockquote>
<ul>
<li>Firefox（chrome党勿喷）</li>
</ul>
<hr>
<blockquote>
<p>文本编辑器</p>
</blockquote>
<ul>
<li><a href="https://notepad-plus-plus.org/" target="_blank" rel="external">Notepad++</a>（win上用）</li>
<li>Vim（*nix系统上）</li>
</ul>
<hr>
<blockquote>
<p>抓包</p>
</blockquote>
<ul>
<li><a href="https://www.charlesproxy.com/" target="_blank" rel="external">Charles</a></li>
</ul>
<hr>
<blockquote>
<p>文档</p>
</blockquote>
<ul>
<li><p>格式</p>
<ul>
<li>Markdown</li>
</ul>
</li>
<li><p>工具</p>
<ul>
<li><a href="https://markdownpad.com/" target="_blank" rel="external">MarkdownPad</a>（win）</li>
<li><a href="http://remarkableapp.github.io/" target="_blank" rel="external">Remarkable</a>（linux）</li>
<li><a href="http://macdown.uranusjr.com/" target="_blank" rel="external">MacDown</a>（osx）</li>
</ul>
</li>
</ul>
<hr>
<blockquote>
<p>版本控制</p>
</blockquote>
<ul>
<li>Git</li>
<li>Svn（较少使用）</li>
</ul>
<hr>
<blockquote>
<p>画图</p>
</blockquote>
<ul>
<li><a href="http://www.xmind.net/" target="_blank" rel="external">Xmind</a></li>
<li><a href="https://www.processon.com/" target="_blank" rel="external">ProcessOn</a></li>
</ul>
<hr>
<blockquote>
<p>终端</p>
</blockquote>
<ul>
<li><a href="http://cmder.net/" target="_blank" rel="external">Cmder</a>（win）</li>
<li>OSX和Linux mint上使用系统自带终端</li>
</ul>
<hr>
<blockquote>
<p>笔记</p>
</blockquote>
<ul>
<li>OneNote</li>
</ul>
<hr>
<blockquote>
<p>科学上网</p>
</blockquote>
<ul>
<li>SS（省略800字 ~-~）</li>
</ul>
<h3 id="修订"><a href="#修订" class="headerlink" title="修订"></a>修订</h3><ul>
<li>2017/8/22 </li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://axlchen.github.com.io/2017/08/22/个人开发工具栈记录/" data-id="cj74s90gs00011g8zuc2afyav" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/工具/">工具</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-LVM动态扩展根分区实战" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/08/15/LVM动态扩展根分区实战/" class="article-date">
  <time datetime="2017-08-14T16:49:20.000Z" itemprop="datePublished">2017-08-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/15/LVM动态扩展根分区实战/">LVM动态扩展根分区实战</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近希望在工作电脑上下载android源码，但因为平时工作的电脑运行的是win7系统，无法下载android源码，所以想到了在VirtualBox上的Linux系统上下载。</p>
<p>不过，android源码体积随着版本升高已经越来越大了，一不小心就占据了几十个G，当初在虚拟机上装的系统只预留了20G左右，并且是使用了LVM技术的，还是挂载在根分区。</p>
<p>无奈我又不想重新装一个系统，凭着对Linux的热情和执着，一番捣鼓之后，终于得偿所愿了。在这里记录一下，希望给以后遇到同样问题的人参考参考，再这里重新演示整个过程。（换回了自己的电脑）</p>
<h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><ul>
<li><p>OS：OSX10.12</p>
</li>
<li><p>VirtualBox版本：5.1.14</p>
</li>
<li><p>Linux发行版：linux mint 17.3</p>
</li>
</ul>
<h2 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h2><hr>
<ol>
<li><p>增大虚拟硬盘</p>
<p> 使用VirtualBox提供了命令行工具VBoxManage，*unix系统应该在安装的时候直接加入了环境变量了，如果是源码安装或者win系统，这命令在安装目录下可以找到，首先列出已经安装的虚拟系统的硬盘：<code>VBoxManage list hdds</code></p>
 <img src="/2017/08/15/LVM动态扩展根分区实战/2.png" alt="2.png" title="">
<p> 其中uuid就是这个虚拟硬盘的标识符，然后通过modifymedium命令就可以改变硬盘的大小：VBoxManage modifymedium uuid –resize xxxx</p>
 <img src="/2017/08/15/LVM动态扩展根分区实战/2.png" alt="1.png" title="1.png">
<p> 现在，我把虚拟硬盘的容量扩大到14000mb</p>
</li>
<li><p>添加物理卷（PV）</p>
<p> 列出现在已经有的PV：<code>sudo pvs</code></p>
 <img src="/2017/08/15/LVM动态扩展根分区实战/8.png" alt="8.png" title="">
<p> 可以看到现在只有一个PV</p>
<p> 增加PV，需要用到磁盘管理工具fdisk，具体步骤</p>
<ul>
<li><code>sudo fdisk /dev/sda</code> (/dev/sda为对应的设备名，也可能是其它名字)</li>
<li>按<code>n</code>新建分区</li>
<li>一直回车选择默认</li>
<li>按<code>t</code>改变分区的system id</li>
<li>选择分区号</li>
<li><p>设置分区system id为8e，其实就是设置分区类型为Linux LVM，通过<code>sudo fdisk -l</code>命令可以看到分区的类型</p>
<img src="/2017/08/15/LVM动态扩展根分区实战/12.png" alt="12.png" title="">
<p>下一步，重启使分区表生效</p>
<img src="/2017/08/15/LVM动态扩展根分区实战/3.png" alt="3.png" title="">
<p>现在，用刚才新建的分区 /dev/sda4 新建PV</p>
<p><code>sudo pvcreate /dev/sda4</code></p>
<p><code>sudo pvs</code></p>
<img src="/2017/08/15/LVM动态扩展根分区实战/4.png" alt="4.png" title="">
<p>PV已经准备好了</p>
</li>
</ul>
</li>
</ol>
<p>3.扩展卷组（VG）</p>
<p><code>sudo vgextend mint-vg /dev/sda4</code> </p>
<p>mint-vg是卷组名，装系统的时候选LVM方式作为磁盘分区的时候默认生成的</p>
<img src="/2017/08/15/LVM动态扩展根分区实战/5.png" alt="5.png" title="">
<p>现在卷组已经扩展成功了</p>
<p>4.扩展逻辑卷（LV）</p>
<p>查看VG的剩余空间</p>
<p><code>sudo vgdisplay</code></p>
<img src="/2017/08/15/LVM动态扩展根分区实战/6.png" alt="6.png" title="">
<p>留意到Free PE一行，总共有435个空闲的PE，1.7G的空闲空间，也就是之前扩展卷组的大小</p>
<p><code>sudo lvextend -l +435 /dev/mint-vg/root</code></p>
<p>-l +435 表示增加435个PE，即全部剩余空间</p>
<p>/dev/mint-vg/root 是LV path，可以通过<code>lvdisplay</code>命令查看</p>
<img src="/2017/08/15/LVM动态扩展根分区实战/7.png" alt="7.png" title="">
<p>逻辑卷也已经扩展成功了</p>
<p>5.使改变生效</p>
<p>现在用<code>df -h</code>命令查看磁盘分区的大小，可以看到根分区还是没有改变的</p>
<img src="/2017/08/15/LVM动态扩展根分区实战/9.png" alt="9.png" title="">
<p><code>sudo resize2fs /dev/mint-vg/root</code></p>
<img src="/2017/08/15/LVM动态扩展根分区实战/10.png" alt="10.png" title="">
<p>这时再看，已经生效了</p>
<p><strong>然而，在这个过程中，我遇到过一直扩展不生效的情况，看下面的重点部分</strong></p>
<h2 id="重点"><a href="#重点" class="headerlink" title="重点"></a>重点</h2><p>如果逻辑卷扩展后没有生效，则需要进入Resuce模式运行resize2fs命令来改变文件系统的大小</p>
<p>进入Resuce模式（linux mint）：重启过程中不断按esc进入系统选择界面，在选择系统界面按e，进入启动参数设置界面，在linux开头这行最后增加“init=/bin/bash”，按ctrl+x启动系统</p>
<img src="/2017/08/15/LVM动态扩展根分区实战/11.png" alt="11.png" title="">
<p>如果提示Read-only file system</p>
<p>将系统挂载成read-write：<code>mount / -o remount,rw</code></p>
<p>这时再resize2fs便可</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="https://linux.cn/article-3974-1.html?pr" target="_blank" rel="external">https://linux.cn/article-3974-1.html?pr</a></li>
<li><a href="http://blog.csdn.net/gaoming655/article/details/7993102" target="_blank" rel="external">http://blog.csdn.net/gaoming655/article/details/7993102</a></li>
<li><a href="http://xxrenzhe.blog.51cto.com/4036116/1272838" target="_blank" rel="external">http://xxrenzhe.blog.51cto.com/4036116/1272838</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://axlchen.github.com.io/2017/08/15/LVM动态扩展根分区实战/" data-id="cj74s90gx00041g8znsnst2is" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LVM/">LVM</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-基于Glide-v4-x的图片加载进度监听" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/08/13/基于Glide-v4-x的图片加载进度监听/" class="article-date">
  <time datetime="2017-08-13T07:48:23.000Z" itemprop="datePublished">2017-08-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/13/基于Glide-v4-x的图片加载进度监听/">基于Glide v4.x的图片加载进度监听</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Glide是一款优秀的图片加载框架，简单的配置便可以使用起来，为开发者省下了很多的功夫。不过，它没有提供其加载图片进度的api，对于这样的需求，实现起来还真颇费一番周折。</p>
<h2 id="尝试"><a href="#尝试" class="headerlink" title="尝试"></a>尝试</h2><p>遇到这个需求，第一反应是网上肯定有人实现过，不妨借鉴一下别人的经验。</p>
<p><a href="http://www.jianshu.com/p/548031c62257" target="_blank" rel="external">Glide加载图片实现进度条效果</a></p>
<p>可惜，这个实现是基于3.7版本的，4.0版本以上的glide改动比较大，using函数已经被移除了</p>
<blockquote>
<p>using()</p>
</blockquote>
<p>The using() API was removed in Glide 4 to encourage users to register their components once with a AppGlideModule to avoid object re-use. Rather than creating a new ModelLoader each time you load an image, you register it once in an AppGlideModule and let Glide inspect your model (the object you pass to load()) to figure out when to use your registered ModelLoader.</p>
<p>To make sure you only use your ModelLoader for certain models, implement handles() as shown above to inspect each model and return true only if your ModelLoader should be used.</p>
<h2 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h2><p>又要用最新的版本又希望给其增加功能，鱼与熊掌不可兼得？“贪新厌旧”的我怎会轻易放弃。我对加载图片进度的需求再理了一遍，发现可以用其他思路简化一下：</p>
<ul>
<li>加载图片分为加载本地图片和网络图片</li>
<li>加载本地图片速度很快，主要耗时在图片解码的工作，如果图片已经在内存中，解码的步骤也省去了</li>
<li>加载网络图片主要时间耗在下载图片数据过程中</li>
</ul>
<p>所以，能监听到图片的下载进度就大概是图片的加载进度了。那难道要先下载图片再交给glide去加载？不用，glide支持整合其他网络模块，例如OkHttp，并且如果我们愿意的话，也可以利用其接口实现自己的网络加载模块。</p>
<p>glide官方仓库提供了OkHttp的整合模块，于是乎我去这些代码了寻找一下突破口。</p>
<h2 id="突破"><a href="#突破" class="headerlink" title="突破"></a>突破</h2><p>OkHttp模块是非常简单的，只有4个文件，并且文件都不长<br>首先，用过glide的都知道，继承GlideModule的类是用于设置glide的配置信息和加载模块的，在OkHttpGlideModule里，向系统注册了一个用于加载GlideUrl类型的组件，简单的可以理解为加载网络图片的组件。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OkHttpGlideModule</span> <span class="keyword">implements</span> <span class="title">GlideModule</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">OkHttpGlideModule</span><span class="params">()</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">applyOptions</span><span class="params">(Context context, GlideBuilder builder)</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerComponents</span><span class="params">(Context context, Glide glide, Registry registry)</span> </span>&#123;</div><div class="line">        registry.replace(GlideUrl.class, InputStream.class, <span class="keyword">new</span> OkHttpUrlLoader.Factory());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>OkHttpLoader文件也很简单，实现了ModelLoader接口，这里ModelLoader是glide的抽象的资源loader的表示，例如这里，就是说加载GlideUrl的model，返回InputStream，即图片的输入流。关于Glide的loadData、model、fetch的详细介绍，可以查看<a href="http://bumptech.github.io/glide/" target="_blank" rel="external">官方文档</a></p>
<p>OkHttpLoader的最终目的，也就是返回了一个LoadData对象。现在情况明确了，glide框架就是利用这个LoadData对象得到图片的输入流，从而下载图片并经过一系列的解码，裁剪，缓存等操作，最后加载出来的。LoadData的参数有一个OkHttpStreamFetcher，从名字看来，这里一定就是下载图片的地方了，我们继续看下去。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OkHttpUrlLoader</span> <span class="keyword">implements</span> <span class="title">ModelLoader</span>&lt;<span class="title">GlideUrl</span>, <span class="title">InputStream</span>&gt; </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> okhttp3.Call.Factory client;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">OkHttpUrlLoader</span><span class="params">(okhttp3.Call.Factory client)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.client = client;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">handles</span><span class="params">(GlideUrl url)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> LoadData&lt;InputStream&gt; <span class="title">buildLoadData</span><span class="params">(GlideUrl model, <span class="keyword">int</span> width, <span class="keyword">int</span> height, Options options)</span> </span>&#123;</div><div class="line">    	<span class="comment">//返回LoadData对象，泛型为InputStream</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> LoadData(model, <span class="keyword">new</span> OkHttpStreamFetcher(<span class="keyword">this</span>.client, model));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Factory</span> <span class="keyword">implements</span> <span class="title">ModelLoaderFactory</span>&lt;<span class="title">GlideUrl</span>, <span class="title">InputStream</span>&gt; </span>&#123;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> okhttp3.Call.Factory internalClient;</div><div class="line">        <span class="keyword">private</span> okhttp3.Call.Factory client;</div><div class="line"></div><div class="line">        <span class="keyword">private</span> <span class="keyword">static</span> okhttp3.Call.<span class="function">Factory <span class="title">getInternalClient</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">if</span>(internalClient == <span class="keyword">null</span>) &#123;</div><div class="line">                Class var0 = OkHttpUrlLoader.Factory.class;</div><div class="line">                <span class="keyword">synchronized</span>(OkHttpUrlLoader.Factory.class) &#123;</div><div class="line">                    <span class="keyword">if</span>(internalClient == <span class="keyword">null</span>) &#123;</div><div class="line">                        internalClient = <span class="keyword">new</span> OkHttpClient();</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">return</span> internalClient;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Factory</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>(getInternalClient());</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Factory</span><span class="params">(okhttp3.Call.Factory client)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.client = client;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> ModelLoader&lt;GlideUrl, InputStream&gt; <span class="title">build</span><span class="params">(MultiModelLoaderFactory multiFactory)</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> OkHttpUrlLoader(<span class="keyword">this</span>.client);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">teardown</span><span class="params">()</span> </span>&#123;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>可以看到，所有的重点都在loadData函数里面了，用过OkHttp的同学，有没有觉得好简单？哈哈。<br>这里直接得到图片的InputStream然后通过回调函数callback.onDataReady()返回了<br>问题来了，callback的glide框架里传过来的，我们并不能控制，我尝试找了一下调用loadData的地方，结果没有找到。怎么办？看最终的实现吧。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OkHttpStreamFetcher</span> <span class="keyword">implements</span> <span class="title">DataFetcher</span>&lt;<span class="title">InputStream</span>&gt; </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"OkHttpFetcher"</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Factory client;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> GlideUrl url;</div><div class="line">    InputStream stream;</div><div class="line">    ResponseBody responseBody;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> Call call;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">OkHttpStreamFetcher</span><span class="params">(Factory client, GlideUrl url)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.client = client;</div><div class="line">        <span class="keyword">this</span>.url = url;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">loadData</span><span class="params">(Priority priority, <span class="keyword">final</span> DataCallback&lt;? <span class="keyword">super</span> InputStream&gt; callback)</span> </span>&#123;</div><div class="line">        Builder requestBuilder = (<span class="keyword">new</span> Builder()).url(<span class="keyword">this</span>.url.toStringUrl());</div><div class="line">        Iterator request = <span class="keyword">this</span>.url.getHeaders().entrySet().iterator();</div><div class="line"></div><div class="line">        <span class="keyword">while</span>(request.hasNext()) &#123;</div><div class="line">            Entry headerEntry = (Entry)request.next();</div><div class="line">            String key = (String)headerEntry.getKey();</div><div class="line">            requestBuilder.addHeader(key, (String)headerEntry.getValue());</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        Request request1 = requestBuilder.build();</div><div class="line">        <span class="keyword">this</span>.call = <span class="keyword">this</span>.client.newCall(request1);</div><div class="line">        <span class="keyword">this</span>.call.enqueue(<span class="keyword">new</span> Callback() &#123;</div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onFailure</span><span class="params">(Call call, IOException e)</span> </span>&#123;</div><div class="line">                <span class="keyword">if</span>(Log.isLoggable(<span class="string">"OkHttpFetcher"</span>, <span class="number">3</span>)) &#123;</div><div class="line">                    Log.d(<span class="string">"OkHttpFetcher"</span>, <span class="string">"OkHttp failed to obtain result"</span>, e);</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                callback.onLoadFailed(e);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onResponse</span><span class="params">(Call call, Response response)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">                OkHttpStreamFetcher.<span class="keyword">this</span>.responseBody = response.body();</div><div class="line">                <span class="keyword">if</span>(response.isSuccessful()) &#123;</div><div class="line">                    <span class="keyword">long</span> contentLength = OkHttpStreamFetcher.<span class="keyword">this</span>.responseBody.contentLength();</div><div class="line">                    OkHttpStreamFetcher.<span class="keyword">this</span>.stream = ContentLengthInputStream.obtain(OkHttpStreamFetcher.<span class="keyword">this</span>.responseBody.byteStream(), contentLength);</div><div class="line">                    callback.onDataReady(OkHttpStreamFetcher.<span class="keyword">this</span>.stream);</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    callback.onLoadFailed(<span class="keyword">new</span> HttpException(response.message(), response.code()));</div><div class="line">                &#125;</div><div class="line"></div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cleanup</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">if</span>(<span class="keyword">this</span>.stream != <span class="keyword">null</span>) &#123;</div><div class="line">                <span class="keyword">this</span>.stream.close();</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException var2) &#123;</div><div class="line">            ;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span>(<span class="keyword">this</span>.responseBody != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">this</span>.responseBody.close();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cancel</span><span class="params">()</span> </span>&#123;</div><div class="line">        Call local = <span class="keyword">this</span>.call;</div><div class="line">        <span class="keyword">if</span>(local != <span class="keyword">null</span>) &#123;</div><div class="line">            local.cancel();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> Class&lt;InputStream&gt; <span class="title">getDataClass</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> InputStream.class;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">getDataSource</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> DataSource.REMOTE;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>在loadData函数里，有这样一句代码</p>
<blockquote>
<p>OkHttpStreamFetcher.this.stream = ContentLengthInputStream.obtain(OkHttpStreamFetcher.this.responseBody.byteStream(), contentLength);</p>
</blockquote>
<p>ContentLengthInputStream是glide的工具类，用来读取输入流的，点进去看看，发现有几个read方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">    <span class="keyword">int</span> value = <span class="keyword">super</span>.read();</div><div class="line">    <span class="keyword">this</span>.checkReadSoFarOrThrow(value &gt;= <span class="number">0</span>?<span class="number">1</span>:-<span class="number">1</span>);</div><div class="line">    <span class="keyword">return</span> value;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">(<span class="keyword">byte</span>[] buffer)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.read(buffer, <span class="number">0</span>, buffer.length);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">(<span class="keyword">byte</span>[] buffer, <span class="keyword">int</span> byteOffset, <span class="keyword">int</span> byteCount)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.checkReadSoFarOrThrow(<span class="keyword">super</span>.read(buffer, byteOffset, byteCount));</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>所以，我的解决方法就是在这里计算下载进度和进行进度的报告的，把这个类从源码里拷贝出来，替换掉OkHttp模块里面的ContentLengthInputStream，并在这插入自己的下载进度逻辑就行了。<br>具体的代码实现就不贴出来了，写个大概的思路：</p>
<p>下载图片的时候传入图片进度监听，用集合容器，例如map保存监听的实例，key为url，下载过程中计算下载进度后通过url找到对应的回调返回进度，图片加载完毕后将回调从集合了移除（glide提供了图片加载完毕的回调）。</p>
<p>ok，就这样，有不合理的地方欢迎指出，又更好更优雅的实现方式请不吝指教。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://axlchen.github.com.io/2017/08/13/基于Glide-v4-x的图片加载进度监听/" data-id="cj74s90h100061g8zwr60pgbv" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/glide/">glide</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/图片加载/">图片加载</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-仿豆瓣首页弹性滑动控件" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/05/仿豆瓣首页弹性滑动控件/" class="article-date">
  <time datetime="2017-07-05T06:30:35.000Z" itemprop="datePublished">2017-07-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/05/仿豆瓣首页弹性滑动控件/">仿豆瓣首页弹性滑动控件</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>逛豆瓣的时候看到了这样的控件，觉得挺有趣，遂模仿之</p>
<h4 id="先看看原版的效果"><a href="#先看看原版的效果" class="headerlink" title="先看看原版的效果"></a>先看看原版的效果</h4><img src="/2017/07/05/仿豆瓣首页弹性滑动控件/douban.gif" alt="douban.gif" title="">
<h4 id="再看看模仿的效果"><a href="#再看看模仿的效果" class="headerlink" title="再看看模仿的效果"></a>再看看模仿的效果</h4><img src="/2017/07/05/仿豆瓣首页弹性滑动控件/mock1.gif" alt="mock1.gif" title="">
<img src="/2017/07/05/仿豆瓣首页弹性滑动控件/mock2.gif" alt="mock2.gif" title="">
<img src="/2017/07/05/仿豆瓣首页弹性滑动控件/mock3.gif" alt="mock3.gif" title="">
<h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><h3 id="控件结构分析"><a href="#控件结构分析" class="headerlink" title="控件结构分析"></a>控件结构分析</h3><p><img src="./结构.png" alt=""></p>
<p>由于*ScrollView只能有一个child view，所以整个child view的结构如图，这里我选择的是LinearLayout作为最外层的布局，content为展示的可滑动的内容，“更多”滑到最右边继续滑时出现的部分，先通过margin把“更多”隐藏</p>
<p>还有“更多”出现时的波纹效果，这个效果是通过贝塞尔曲线实现的，这里的实现比较简单，只取一个控制点，y坐标的数值为height的一半，x坐标随滑动距离变化</p>
<h3 id="关键代码"><a href="#关键代码" class="headerlink" title="关键代码"></a>关键代码</h3><p>控件的滑动效果由child view（下称wrapView）和content view（下称contentView）配合产生</p>
<ol>
<li>当滑动到最左边并继续滑动的时候，wrapView的scrollX变化，产生第1个gif图效果</li>
<li>当滑动到最右边并继续滑动的时候，wrapView的scrollX先变化，当滑出到一定距离的时候，contentView的scrollX变化，产生第3个gif图效果</li>
<li>其他情况不处理滑动，交由<code>HorizontalScrollView</code>处理</li>
</ol>
<p>详细参考以下代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">onTouchEvent</span><span class="params">(MotionEvent ev)</span> </span>&#123;</div><div class="line">    <span class="keyword">switch</span> (ev.getAction()) &#123;</div><div class="line">        <span class="keyword">case</span> MotionEvent.ACTION_DOWN:</div><div class="line">            mLastX = ev.getRawX();</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> MotionEvent.ACTION_MOVE:</div><div class="line">            <span class="keyword">float</span> mDeltaX = (ev.getRawX() - mLastX);</div><div class="line">            mLastX = ev.getRawX();</div><div class="line">            mDeltaX = mDeltaX * RATIO;</div><div class="line">            <span class="keyword">if</span> (mDeltaX &gt; <span class="number">0</span>) &#123;</div><div class="line">                <span class="comment">//不能左滑或者外层布局的scrollX &gt; 0</span></div><div class="line">                <span class="keyword">if</span> (!canScrollHorizontally(-<span class="number">1</span>) || mWrapView.getScrollX() &gt; <span class="number">0</span>) &#123;</div><div class="line">                    <span class="comment">//contentView的scrollX &gt; 0，contentView scroll，使scrollX变化</span></div><div class="line">                    <span class="keyword">if</span> (mContentView.getScrollX() &gt; <span class="number">0</span>) &#123;</div><div class="line">                        mContentView.scrollBy((<span class="keyword">int</span>) -mDeltaX, <span class="number">0</span>);</div><div class="line">                        mMsg.setText(mStringDragged);</div><div class="line">                    &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        <span class="comment">//wrapView的scrollX &gt; 0，wrapView scroll，使scrollX变化</span></div><div class="line">                        mWrapView.scrollBy((<span class="keyword">int</span>) -mDeltaX, <span class="number">0</span>);</div><div class="line">                        mMsg.setText(mStringDragging);</div><div class="line"></div><div class="line">                        <span class="comment">//贝塞尔曲线控制点变化</span></div><div class="line">                        mControlPoint.x = (<span class="keyword">int</span>) (mRect.right - mWrapView.getScrollX() * RIPPLE_RATIO);</div><div class="line">                        mControlPoint.y = mRect.bottom / <span class="number">2</span>;</div><div class="line">                        invalidate();</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">                &#125;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="comment">//不能右滑或者外层布局的scrollX &lt; 0</span></div><div class="line">                <span class="keyword">if</span> (!canScrollHorizontally(<span class="number">1</span>) || mWrapView.getScrollX() &lt; <span class="number">0</span>) &#123;</div><div class="line">                    <span class="keyword">if</span> (!canScrollHorizontally(<span class="number">1</span>)) &#123;</div><div class="line">                        getDrawingRect(mRect);</div><div class="line">                    &#125;</div><div class="line">                    <span class="comment">//wrapView的scrollX &gt;= 产生"更多"动作的距离，contentView scroll，使scrollX变化</span></div><div class="line">                    <span class="keyword">if</span> (mWrapView.getScrollX() &gt;= mOffset) &#123;</div><div class="line">                        mContentView.scrollBy((<span class="keyword">int</span>) -mDeltaX, <span class="number">0</span>);</div><div class="line">                        mMsg.setText(mStringDragged);</div><div class="line">                    &#125; <span class="keyword">else</span> &#123;</div><div class="line">                        <span class="comment">//wrapView的scrollX &lt; 0，wrapView scroll，使scrollX变化</span></div><div class="line">                        mWrapView.scrollBy((<span class="keyword">int</span>) -mDeltaX, <span class="number">0</span>);</div><div class="line">                        mMsg.setText(mStringDragging);</div><div class="line"></div><div class="line">                        <span class="comment">//贝塞尔曲线控制点变化</span></div><div class="line">                        mControlPoint.x = (<span class="keyword">int</span>) (mRect.right - mWrapView.getScrollX() * RIPPLE_RATIO);</div><div class="line">                        mControlPoint.y = mRect.bottom / <span class="number">2</span>;</div><div class="line">                        invalidate();</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> MotionEvent.ACTION_CANCEL:</div><div class="line">        <span class="keyword">case</span> MotionEvent.ACTION_UP:</div><div class="line">            checkAction();</div><div class="line">            <span class="keyword">if</span> (mWrapView.getScrollX() &lt; <span class="number">0</span>) &#123;</div><div class="line">                mScroller.startScroll(mWrapView.getScrollX(), <span class="number">0</span>, <span class="number">0</span> - mWrapView.getScrollX(), <span class="number">0</span>,</div><div class="line">                        (<span class="number">0</span> - mWrapView.getScrollX()) * <span class="number">5</span>);</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mContentView.getScrollX() &gt; <span class="number">0</span>) &#123;</div><div class="line">                mScroller.startScroll(mContentView.getScrollX() + mWrapView.getScrollX(), <span class="number">0</span>,</div><div class="line">                        <span class="number">0</span> - mContentView.getScrollX() - mWrapView.getScrollX(), <span class="number">0</span>,</div><div class="line">                        (mContentView.getScrollX() + mWrapView.getScrollX()) * <span class="number">6</span>);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                mScroller.startScroll(mWrapView.getScrollX(), <span class="number">0</span>, <span class="number">0</span> - mWrapView.getScrollX(), <span class="number">0</span>,</div><div class="line">                        mWrapView.getScrollX() * <span class="number">5</span>);</div><div class="line">            &#125;</div><div class="line">            invalidate();</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.onTouchEvent(ev);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>松手后复原的滑动效果使用<code>Scroller</code>完成，读者可参考相关文档和文章</p>
<h3 id="源码和demo"><a href="#源码和demo" class="headerlink" title="源码和demo"></a>源码和demo</h3><p>github:<a href="https://github.com/Axlchen/horizontal-elasticity-scrollview" target="_blank" rel="external">horizontal-elasticity-scrollview</a></p>
<p>欢迎交流</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://axlchen.github.com.io/2017/07/05/仿豆瓣首页弹性滑动控件/" data-id="cj74s90gz00051g8z1mww5qzr" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/自定义控件/">自定义控件</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/其他/">其他</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/LVM/">LVM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NoSuchFieldError/">NoSuchFieldError</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/glide/">glide</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/图片加载/">图片加载</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/工具/">工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/自定义控件/">自定义控件</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/LVM/" style="font-size: 10px;">LVM</a> <a href="/tags/NoSuchFieldError/" style="font-size: 10px;">NoSuchFieldError</a> <a href="/tags/glide/" style="font-size: 10px;">glide</a> <a href="/tags/图片加载/" style="font-size: 10px;">图片加载</a> <a href="/tags/工具/" style="font-size: 10px;">工具</a> <a href="/tags/自定义控件/" style="font-size: 10px;">自定义控件</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/08/22/个人开发工具栈记录/">个人开发工具栈记录</a>
          </li>
        
          <li>
            <a href="/2017/08/15/LVM动态扩展根分区实战/">LVM动态扩展根分区实战</a>
          </li>
        
          <li>
            <a href="/2017/08/13/基于Glide-v4-x的图片加载进度监听/">基于Glide v4.x的图片加载进度监听</a>
          </li>
        
          <li>
            <a href="/2017/07/05/仿豆瓣首页弹性滑动控件/">仿豆瓣首页弹性滑动控件</a>
          </li>
        
          <li>
            <a href="/2017/04/10/Android-NoSuchFieldError/">Android NoSuchFieldError</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Axlchen<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>